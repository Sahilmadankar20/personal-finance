{% extends 'base.html' %}
{% block title %}Admin Dashboard{% endblock %}

{% block content %}
<div class="container mt-4">
  <h2 class="mb-4"> Admin Dashboard</h2>
  <p>Welcome, Admin Sahil! Here you can see all registered users, their income, and goals.</p>

  <div class="card p-3 shadow-sm">
    <table class="table table-striped table-hover">
      <thead class="table-dark">
        <tr>
          <th>#</th>
          <th>Name</th>
          <th>Email</th>
          <th>Occupation</th>
          <th>Monthly Income</th>
          <th>Goals</th>
          <th>Action</th> <!-- New column for delete -->
        </tr>
      </thead>
      <tbody>
        {% for user in users %}
        <tr>
          <td>{{ loop.index }}</td>
          <td>{{ user.name }}</td>
          <td>{{ user.email }}</td>
          <td>{{ user.occupation or 'N/A' }}</td>
          <td>{{ user.monthly_income or 'N/A' }}</td>
          <td>
            {% if user.goals %}
              <ul>
                {% for goal in user.goals %}
                  <li>{{ goal.name }} (â‚¹{{ goal.cost }}, Source: {{ goal.source }})</li>
                {% endfor %}
              </ul>
            {% else %}
              <em>No goals</em>
            {% endif %}
          </td>
          <td>
            {% if user.id != current_user.id %}
            <form action="{{ url_for('delete_user', user_id=user.id) }}" method="POST" 
                  onsubmit="return confirm('Are you sure you want to delete this user?');">
              <button class="btn btn-sm btn-danger" type="submit">Delete</button>
            </form>
            {% else %}
              <em>Current Admin</em>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
